"use strict";(self.webpackChunkgeotab=self.webpackChunkgeotab||[]).push([[179],{197:(e,t,a)=>{var l=a(294),c=a(935),r=a(117);const s=function*(e){for(;;)yield"_react_component_"+e++}(0);function n(e,t){return e>t?1:e<t?-1:0}(()=>{let e=!0;setInterval((()=>e=!0),200)})();const i=function({title:e,value:t}){return l.createElement("li",{key:t,className:["mdc-deprecated-list-item",...t===this.value&&["mdc-deprecated-list-item--selected"]||[]].join(" "),"data-value":t,role:"option"},l.createElement("span",{className:"mdc-deprecated-list-item__ripple"}),l.createElement("span",{className:"mdc-deprecated-list-item__text"},e))},o=({options:e,name:t,value:a,placeholder:c="Select item",callback:n=(()=>{})})=>{const[o,d]=(0,l.useState)(null),[m]=(0,l.useState)(s.next().value);(0,l.useEffect)((()=>{if(o)return()=>o.destroy();const e=new r.H(document.getElementById(m));return d(e),e.listen("MDCSelect:change",(({detail:{value:e}})=>n(t,e))),()=>e.destroy()}),[]);const{title:u=""}=(0,l.useMemo)((()=>e.find((({value:e})=>e===a))??{}),[e,a]),p=(0,l.useMemo)((()=>e.map(i,{value:a})),[e,a]);return l.createElement("div",{id:m,className:"mdc-select mdc-select--filled auto-width custom-select"},l.createElement("div",{className:"mdc-select__anchor",role:"button","aria-haspopup":"listbox","aria-expanded":"false","aria-labelledby":"demo-label demo-selected-text"},l.createElement("span",{className:"mdc-select__ripple"}),l.createElement("span",{id:"demo-label",className:"mdc-floating-label"},c),l.createElement("span",{className:"mdc-select__selected-text-container"},l.createElement("span",{id:"demo-selected-text",className:"mdc-select__selected-text"},u)),l.createElement("span",{className:"mdc-select__dropdown-icon"},l.createElement("svg",{className:"mdc-select__dropdown-icon-graphic",viewBox:"7 10 10 5",focusable:"false"},l.createElement("polygon",{className:"mdc-select__dropdown-icon-inactive",stroke:"none",fillRule:"evenodd",points:"7 10 12 15 17 10"}),l.createElement("polygon",{className:"mdc-select__dropdown-icon-active",stroke:"none",fillRule:"evenodd",points:"7 15 12 10 17 15"}))),l.createElement("span",{className:"mdc-line-ripple"})),l.createElement("div",{className:"mdc-select__menu mdc-menu mdc-menu-surface mdc-menu-surface--fullwidth"},l.createElement("ul",{className:"mdc-deprecated-list",role:"listbox","aria-label":"Value picker listbox"},p)))},d={param1:{options:[{title:"Option 1",value:"1"},{title:"Option 2",value:"2"},{title:"Option 3",value:"3"}],value:"",label:"Select parameter 1"},param2:{options:[{title:"Option 1",value:"1"},{title:"Option 2",value:"2"},{title:"Option 3",value:"3"}],value:"",label:"Select parameter 2"},param3:{options:[{title:"Option 1",value:"1"},{title:"Option 2",value:"2"},{title:"Option 3",value:"3"}],value:"",label:"Select parameter 3"}},m=({onChange:e})=>{const{current:t}=(0,l.useRef)(new Map(Object.keys(d).map((e=>[e,null])))),a=(0,l.useCallback)(((a,l)=>{t.set(a,l),e(t)}),[]);return l.createElement("div",{className:"flex flex--spreaded flex--wrap"},Object.entries(d).map((([e,{options:t,label:c,value:r}])=>l.createElement("div",{key:e,className:"filter-control"},l.createElement(o,{options:t,value:r,placeholder:c,callback:a})))))};var u=a(243),p=a.n(u);const _="./credentials.json",b={_listeners:{},subscribe(e,t,a=null){this._listeners[e]=[...this._listeners[e]??[],[t,a]]},dispatch(e,t){this._listeners[e]?.forEach((([e,a])=>{e.call(a,t)}))},unsubscribe(e,t){const a=this._listeners[e]?.findIndex(t)??-1;a>-1&&this._listeners[e].splice(a,1)},async makeRequest(e){let t;this.dispatch(ACTION.PENDING_REQUEST);try{const a=await fetch(e);try{t=await a.clone().json()}catch(e){t=await a.text()}if(!a.ok)throw new Error(`${t?.error??t}`);return t}catch({message:e}){this.dispatch(ACTION.ERROR_REQUEST,e)}finally{this.dispatch(ACTION.COMPLETE_REQUEST)}}},v="error_request",h=(g=new DOMParser,e=>g.parseFromString(e,"text/html").body?.firstElementChild??document.createElement("div"));var g;a(965),a(803),a(134),a(94),a(403);const E=(async()=>{const{server:e,...t}=await async function(){try{const{server:e,database:t,user:a,password:l}=await(await fetch(_)).json();return{server:e,database:t,userName:a,password:l}}catch({message:e}){return b.dispatch(v,e),{}}}();new window.GeotabApi({credentials:t,path:e})})();const f=({items:e,children:t})=>{const[a,c]=(0,l.useState)(null),{current:r}=(0,l.useRef)({});return(0,l.useEffect)((async()=>{let[e,t,a,l]=["",[50,30],"",""];try{({accessToken:e,center:t,attribution:a,tileLayerUrl:l}=await(await fetch(_)).json())}catch({message:e}){return void b.dispatch(v,e)}const r=p().map("leaflet-map").setView(t,16);p().tileLayer(l,{attribution:a,maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:e}).addTo(r),c(r)}),[]),(0,l.useMemo)((()=>{if(!a)return;const t=e.map((({id:e,...t})=>t?(e in r?function(e,{latitude:t,longitude:a,bearing:l}){e.setLatLng(p().latLng(t,a)).setIcon(y())}(r[e],t):r[e]=function({latitude:e,longitude:t,bearing:a,...l},c){return p().marker(p().latLng(e,t),{icon:y()}).addTo(c).on("mouseover",N,l)}(t,a),e):e));Object.entries(r).forEach((([e,a])=>{t.includes(e)||(a.remove(),delete r[e])}))}),[e,a]),l.createElement("div",{className:"leaflet-map-map auto-height"},l.createElement("div",{id:"leaflet-map",className:"auto-height"}),l.createElement("div",{className:"leaflet-map-overlay"},t))};function y(e){return p().divIcon({iconSize:p().point(24,24),className:"car-icon material-icons",html:"directions_car"})}async function N(e){return t=e.target,a=h((({icon:e="",name:t="",status:a="",group:l="",driver:c="",driverFICO:r="",location:s="",issues:n=""})=>`\n    <div class="car-tooltip">\n        <div class="car-tooltip__icon">\n            <img class="icon__img auto-width auto-height" src="${e}" alt="car icon">\n        </div>\n        <div class="car-tooltip__name">${t}</div>\n        <div class="car-tooltip__status">${a}</div>\n        <div class="car-tooltip__group">${l}</div>\n        <div class="car-tooltip__driver">${c}</div>\n        <div class="car-tooltip__driver-fico">${r}</div>\n        <div class="car-tooltip__location">${s}</div>\n        <div class="car-tooltip__issues">${n}</div>\n    </div>`)(this)),void t.bindTooltip(a).openTooltip();var t,a}var w=a(828);const k={ascending:0,descending:1},x=(e,t)=>l.createElement("th",{key:t,className:"mdc-data-table__header-cell mdc-data-table__header-cell--with-sort",role:"columnheader",scope:"col","data-column-id":`column-${t}`},l.createElement("div",{className:"mdc-data-table__header-cell-wrapper"},l.createElement("div",{className:"mdc-data-table__header-cell-label"},e),l.createElement("button",{className:"mdc-icon-button material-icons mdc-data-table__sort-icon-button","aria-label":`Sort by column-${t}`,"aria-describedby":`${t}-label`},"arrow_upward"),l.createElement("div",{className:"mdc-data-table__sort-status-label","aria-hidden":"true",id:`${t}-label`}))),C=(e,t)=>l.createElement("td",{key:t,className:"mdc-data-table__cell"},t?e:new Date(e).toLocaleString()),S=({id:e,columns:t})=>l.createElement("tr",{key:e,className:"mdc-data-table__row"},t.map(C)),M=({head:e,body:t,onClickCallback:a,children:c,onSortCallback:r=(()=>{})})=>{const[s,n]=(0,l.useState)(null);(0,l.useEffect)((()=>{if(s)return()=>e.destroy();const e=new w.T(document.getElementById("app-data-table"));return n(e),e.listen("MDCDataTable:sorted",(({detail:{columnIndex:e,sortValue:t}})=>{r([e,k[t]])})),()=>e.destroy()}),[]),(0,l.useLayoutEffect)((()=>{s?.layout()}),[t]);const i=(0,l.useMemo)((()=>e.map(x)),[e]),o=(0,l.useMemo)((()=>t.map(S)),[t]);return l.createElement("div",{id:"app-data-table",className:"mdc-data-table auto-width"},l.createElement("div",{className:"mdc-data-table__table-container"},l.createElement("table",{className:"mdc-data-table__table"},l.createElement("thead",null,l.createElement("tr",{className:"mdc-data-table__header-row"},i)),l.createElement("tbody",{className:"mdc-data-table__content",onClick:a},o))),c)},D=[{title:"10",value:10},{title:"50",value:50},{title:"100",value:100}],I=({total:e=0,pageSize:t=10,callback:a=(()=>{})})=>{const{current:c}=(0,l.useRef)({size:Math.min(e,t),index:0,total:e}),{size:r,index:s,total:n}=c,i=(0,l.useMemo)((()=>s===Math.floor(n/r)),[r,s,n]),d=(0,l.useCallback)((()=>{a([r,c.index=0])}),[a]),m=(0,l.useCallback)((()=>{a([r,c.index=Math.max(c.index-1,0)])}),[a]),u=(0,l.useCallback)((()=>{a([r,c.index=Math.min(c.index+1,Math.floor(c.total/c.size))])}),[a]),p=(0,l.useCallback)((()=>{a([r,c.index=Math.floor(c.total/c.size)])}),[a]),_=(0,l.useCallback)((e=>{a([c.size=e,s])}),[]);return l.createElement("div",{className:"mdc-data-table__pagination"},l.createElement("div",{className:"mdc-data-table__pagination-trailing"},l.createElement("div",{className:"mdc-data-table__pagination-rows-per-page"},l.createElement("div",{className:"mdc-data-table__pagination-rows-per-page-label"},"Records per page"),l.createElement(o,{options:D,value:10,placeholder:"Page size",callback:_})),l.createElement("div",{className:"mdc-data-table__pagination-navigation"},l.createElement("div",{className:"mdc-data-table__pagination-total"},r*s+1," - ",r*(s+1)," of ",n),l.createElement("button",{className:"mdc-icon-button material-icons mdc-data-table__pagination-button","data-first-page":"true",disabled:!s,onClick:d},l.createElement("div",{className:"mdc-button__icon"},"first_page")),l.createElement("button",{className:"mdc-icon-button material-icons mdc-data-table__pagination-button","data-prev-page":"true",disabled:!s,onClick:m},l.createElement("div",{className:"mdc-button__icon"},"chevron_left")),l.createElement("button",{className:"mdc-icon-button material-icons mdc-data-table__pagination-button","data-next-page":"true",onClick:u,disabled:i},l.createElement("div",{className:"mdc-button__icon"},"chevron_right")),l.createElement("button",{className:"mdc-icon-button material-icons mdc-data-table__pagination-button","data-last-page":"true",onClick:p,disabled:i},l.createElement("div",{className:"mdc-button__icon"},"last_page")))))},O=(e,t)=>({columns:a},{columns:l})=>{const[c,r]=[a[e],l[e]];return t?n(r,c):n(c,r)},T=["Toyota","Ford","Mitsubishi","Volkswagen","BMW"],R=["Car accident","Engine fault","Tyre deflate","Illegal trespassing"],$=["Time","Vehicle","Type","Driver"],z=new Array(112).fill(void 0).map(((...[,e])=>{const t=new Date;return t.setDate(Math.round(10*Math.random())),{id:`row-${e}`,columns:[+t,T[Math.floor(Math.random()*T.length)],R[Math.floor(Math.random()*R.length)],"John Doe"]}})),B=()=>{const[e,t]=(0,l.useState)(z.slice(0,10)),{current:a}=(0,l.useRef)({slice:{from:0,to:10},sort:{by:0,direction:0}}),c=(0,l.useCallback)((([e,l])=>{const c=z.sort(O(a.sort.by,a.sort.direction)).slice(a.slice.from=e*l,a.slice.to=e*(l+1));t(c)}),[e]),r=(0,l.useCallback)((([e,l])=>{const c=z.sort(O(a.sort.by=e,a.sort.direction=l)).slice(a.slice.from,a.slice.to);t(c)}),[e]);return l.createElement(M,{head:$,body:e,onSortCallback:r},l.createElement(I,{total:z.length,pageSize:10,callback:c}))};var L=a(974);const j=(new Date).toISOString(),A=[1,-1],V=new Array(18).fill([59.121151,37.927722]).map((([e,t],a)=>({id:`car${a+1}`,name:"Legend Car #1",status:`Driving 100 mph on ${(new Date).toLocaleString()}`,group:"Amped Air",location:"Russian Federation, Vologda region, Cherepovets, Karl Lipknecht st.",issues:"3 of 4 wheels deflated, engine is stucked",latitude:e+.005*Math.random()*A[Math.round(Math.random())],longitude:t+.005*Math.random()*A[Math.round(Math.random())],driver:"John Doe",icon:"https://thumbs.dreamstime.com/z/old-small-car-20980399.jpg"}))),F=()=>{const[e,t]=(0,l.useState)([]),[a,c]=(0,l.useState)([]),[r,s]=(0,l.useState)({}),{current:n}=(0,l.useRef)({deviceInfoStatus:null});(0,l.useCallback)((({})=>{const e=a.map((([e,t])=>{const{value:a,done:l}=t.next();return{id:e,...!l&&a}}));t(e)}),[a]),(0,l.useCallback)((async({})=>{const{data:e=[],toVersion:t}=await async function(){try{return await E.call(...arguments)}catch({message:e}){return b.dispatch(v,e),[]}}("GetFeed",{typeName:"DeviceInfoStatus",fromVersion:n.deviceInfoStatus,resultsLimit:Math.ceil(20),search:{fromDate:j,...r}}),a=Object.entries(e.reduce(((e,{device:{id:t},...a})=>((e[t]??(e[t]=[])).push(a),e)),{})).map((([e,t])=>[e,t[Symbol.iterator]()]));c(a),n.logRecord=t}),[r]),(0,l.useEffect)((()=>(new L.t(document.getElementById("top-app-bar")),()=>{clearInterval(carMotionInterval),clearInterval(pollFeedDataInterval)})));const i=(0,l.useCallback)((e=>{}),[]);return l.createElement("div",{className:"mdc-layout-grid__inner"},l.createElement("div",{className:"mdc-layout-grid__cell mdc-layout-grid__cell--span-12"},l.createElement("h1",{className:"mdc-typography--headline4 centered"},"Real time data observation")),l.createElement("div",{className:"mdc-layout-grid__cell mdc-layout-grid__cell--span-12 leaflet-map-container"},l.createElement(f,{items:V},l.createElement(m,{onChange:i}))),l.createElement("div",{className:"mdc-layout-grid__cell mdc-layout-grid__cell--span-12"},l.createElement("h2",{className:"mdc-typography--headline5 centered"},"Event log")),l.createElement("div",{className:"mdc-layout-grid__cell mdc-layout-grid__cell--span-12"},l.createElement(B,null)))};var P=a(825);const W=()=>{const[e,t]=(0,l.useState)(null),[a,r]=(0,l.useState)(0),s=(0,l.useCallback)((()=>r(a+1)),[]),n=(0,l.useCallback)((()=>r(a-1)),[]);return(0,l.useEffect)((()=>{if(e)return()=>e.destroy();const a=new P.z(document.getElementById("app-loader"));return a.determinate=!1,t(a),b.subscribe("pending_request",s),b.subscribe("complete_request",n),()=>a.destroy()}),[]),(0,l.useMemo)((()=>{e&&(a?e.open():e.close())}),[a,e]),(0,c.createPortal)(l.createElement("div",{id:"app-loader",className:"mdc-circular-progress app-loader",role:"progressbar","aria-label":"Example Progress Bar","aria-valuemin":"0","aria-valuemax":"1"},l.createElement("div",{className:"mdc-circular-progress__determinate-container"},l.createElement("svg",{className:"mdc-circular-progress__determinate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},l.createElement("circle",{className:"mdc-circular-progress__determinate-track",cx:"24",cy:"24",r:"18",strokeWidth:"4"}),l.createElement("circle",{className:"mdc-circular-progress__determinate-circle",cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"113.097",strokeWidth:"4"}))),l.createElement("div",{className:"mdc-circular-progress__indeterminate-container"},l.createElement("div",{className:"mdc-circular-progress__spinner-layer"},l.createElement("div",{className:"mdc-circular-progress__circle-clipper mdc-circular-progress__circle-left"},l.createElement("svg",{className:"mdc-circular-progress__indeterminate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},l.createElement("circle",{cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"56.549",strokeWidth:"4"}))),l.createElement("div",{className:"mdc-circular-progress__gap-patch"},l.createElement("svg",{className:"mdc-circular-progress__indeterminate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},l.createElement("circle",{cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"56.549",strokeWidth:"3.2"}))),l.createElement("div",{className:"mdc-circular-progress__circle-clipper mdc-circular-progress__circle-right"},l.createElement("svg",{className:"mdc-circular-progress__indeterminate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},l.createElement("circle",{cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"56.549",strokeWidth:"4"})))))),document.body)};var q=a(613);const G=()=>{const[e,t]=(0,l.useState)(null),[a,r]=(0,l.useState)(""),s=(0,l.useCallback)((()=>r("")));return(0,l.useEffect)((()=>{if(e)return()=>e.destroy();const a=new q.G(document.getElementById("app-snackbar"));return a.labelText="Error",a.closeOnEscape=!0,a.listen("MDCSnackbar:closed",s),t(a),b.subscribe(v,r),()=>a.destroy()}),[]),(0,l.useMemo)((()=>{e&&(a?e.open():e.close())}),[a]),(0,c.createPortal)(l.createElement("aside",{id:"app-snackbar",className:"mdc-snackbar"},l.createElement("div",{className:"mdc-snackbar__surface",role:"status","aria-relevant":"additions"},l.createElement("div",{className:"mdc-snackbar__label","aria-atomic":"false"},a))),document.body)};a(696),c.render(l.createElement(l.Fragment,null,l.createElement(G,null),l.createElement(F,null),l.createElement(W,null)),document.getElementById("root"))},696:(e,t,a)=>{e.exports=a.p+"credentials.json"}},e=>{e.O(0,[216],(()=>(197,e(e.s=197)))),e.O()}]);