"use strict";(self.webpackChunkgeotab=self.webpackChunkgeotab||[]).push([[179],{186:(e,t,a)=>{var r=a(294),c=a(935),n=a(974),s=a(252),i=a(479),l=a(403);const o=({title:e,formId:t,submitBtnId:a,children:[c,n],onSubmit:s,onClose:i})=>{const[o,d]=(0,r.useState)(null);return(0,r.useEffect)((()=>{if(o)return()=>o.destroy();const e=new l.W(document.getElementById("app-dialog"));return e.listen("MDCDialog:closing",i),d(e),e.open(),document.getElementById(t)?.addEventListener("submit",s),document.getElementById(t)?.addEventListener("input",(function(e){this.elements[a].disabled=!this.checkValidity()})),()=>e.destroy()}),[]),r.createElement("div",{id:"app-dialog",className:"mdc-dialog"},r.createElement("div",{className:"mdc-dialog__container"},r.createElement("div",{className:"mdc-dialog__surface"},r.createElement("h2",{className:"mdc-dialog__title centered"},e),r.createElement("div",{className:"mdc-dialog__content"},c),r.createElement("div",{className:"mdc-dialog__actions"},r.createElement("button",{type:"button",className:"mdc-button mdc-dialog__button","data-mdc-dialog-action":"close"},r.createElement("div",{className:"mdc-button__ripple"}),r.createElement("span",{className:"mdc-button__label"},"Cancel")),n))),r.createElement("div",{className:"mdc-dialog__scrim"}))};var d=a(113);const m=({type:e="text",name:t,value:a,placeholder:c,autoComplete:n="off",required:s=!1,onChange:i})=>{const[l,o]=(0,r.useState)(null),[m]=(0,r.useState)(h.next().value);return(0,r.useEffect)((()=>{if(l)return()=>l.destroy();const e=new d.K(document.getElementById(m));return o(e),()=>e.destroy()}),[]),(0,r.useEffect)((()=>{l&&(l.value=a)}),[a]),r.createElement("label",{id:m,className:"mdc-text-field mdc-text-field--filled auto-width"},r.createElement("span",{className:"mdc-text-field__ripple"}),r.createElement("span",{className:"mdc-floating-label",id:`${t}Field`},c),r.createElement("input",{type:e,name:t,defaultValue:a,autoComplete:n,className:"mdc-text-field__input",required:s,onChange:i}),r.createElement("span",{className:"mdc-line-ripple"}))},u={_listeners:{},subscribe(e,t,a=null){this._listeners[e]=[...this._listeners[e]??[],[t,a]]},dispatch(e,t){this._listeners[e]?.forEach((([e,a])=>{e.call(a,t)}))},unsubscribe(e,t){const a=this._listeners[e]?.findIndex(t)??-1;a>-1&&this._listeners[e].splice(a,1)},async makeRequest(e){let t;this.dispatch(ACTION.PENDING_REQUEST);try{const a=await fetch(e);try{t=await a.clone().json()}catch(e){t=await a.text()}if(!a.ok)throw new Error(`${t?.error??t}`);return t}catch({message:e}){this.dispatch(ACTION.ERROR_REQUEST,e),console.error(e)}finally{this.dispatch(ACTION.COMPLETE_REQUEST)}}},p="error_request",g="set_user",h=function*(e){for(;;)yield"_react_component_"+e++}(0);function v(e,t){return e>t?1:e<t?-1:0}function f(){try{const{database:e,sessionId:t,userName:a}=JSON.parse(localStorage.getItem("geotabAPI_credentials"));return{email:a,database:e,sessionId:t,server:localStorage.getItem("geotabAPI_server")}}catch(e){}return null}function E(e,t){const a="authorize-form",n="form-submit-btn";c.render(r.createElement(o,{title:"Login to GeoTab",formId:a,submitBtnId:n,onSubmit:t=>{t.preventDefault();const a=new FormData(t?.target),r=a.get("username")?.trim(),n=a.get("password")?.trim(),s=a.get("database")?.trim(),i=a.get("server")?.trim();e({email:r,password:n,database:s,server:i}),u.dispatch(g,{email:r}),c.unmountComponentAtNode(document.getElementById("dialog-pane"))},onClose:()=>{c.unmountComponentAtNode(document.getElementById("dialog-pane")),t(new Error("Authentication failed"))}},[r.createElement("form",{key:"form",id:a,className:"flex flex--column flex--spreaded"},[r.createElement(m,{key:"server-input",name:"server",placeholder:"server",required:!0,value:"my5.geotab.com"}),r.createElement(m,{key:"database-input",name:"database",placeholder:"database",required:!0,value:"rollins"}),r.createElement(m,{key:"email-input",type:"email",name:"username",placeholder:"user name",autoComplete:"email",required:!0}),r.createElement(m,{key:"password-input",type:"password",name:"password",placeholder:"password",autoComplete:"current-password",required:!0})]),r.createElement("button",{key:"submit-button",id:n,type:"submit",form:a,className:"mdc-button mdc-dialog__button data-mdc-dialog-button-default",disabled:!0},[r.createElement("div",{key:"mdc-ripple",className:"mdc-button__ripple"}),r.createElement("span",{key:"submit-button-label",className:"mdc-button__label"},"Login")])]),document.getElementById("dialog-pane"))}const b={driver:new Map,rule:new Map,device:new Map,group:new Map,trip:new Map},_=r.createContext(null),y=[{name:"ayqvrTR8lIkiMFFZtHz2xdw",title:"Backing Up When Leaving",checked:!0},{name:"aCdkH9ou4QEKRsJmUYQh6CQ",title:"Harsh Acceleration",checked:!0},{name:"auV1Pjb5pTkC5OzkCwOxoJA",title:"Harsh Brake",checked:!0},{name:"a4zk6nwPd-kus-jY3zBPPqw",title:"Harsh Cornering",checked:!0},{name:"RuleAccidentId",title:"Possible Accident",checked:!0},{name:"aX_l5MgXx8UODDE5rq2ovKw",title:"Speeding > 80 MPH",checked:!0}],w=new Map([["divisions",{label:"Division",options:new Set,checked:new Set,dependentFilter:"regions"}],["regions",{label:"Region",options:new Set,checked:new Set,dependentFilter:"branches"}],["branches",{label:"Branch",options:new Set,checked:new Set}]]),N="check_all",k="divider",x=({options:e,name:t,label:a,onChange:c})=>{const[n]=(0,r.useState)(h.next().value),l=(0,r.useCallback)((({detail:{item:e}})=>{let{instance:{list:{listElements:a,selectedIndex:r}}}=o;if(e.id===N){const{checked:r=!1}=e.getElementsByTagName("input").item(0)??{};return c?.(t,r&&a.map((({id:e})=>e))||[])}c?.(t,r.reduce(((e,t)=>[...e,...a[t]?.id!==N&&[a[t]?.id]||[]]),[]))}),[]),{current:o}=(0,r.useRef)({instance:null});(0,r.useEffect)((()=>{o.instance?.unlisten("MDCMenu:selected",l),o.instance?.destroy();const e=document.getElementById(n),t=new s.g(e);t.setAnchorCorner(i.Ns.BOTTOM_LEFT),t.setFixedPosition(!0),t.open=!1,o.instance=t,t.listen("MDCMenu:selected",l)}),[e]);const d=(0,r.useMemo)((()=>[S({name:N,title:"Select all",checked:e.every((({checked:e})=>!!e))}),S({name:k}),...e.map(S)]),[e]);return r.createElement("div",{className:"mdc-menu-surface--anchor"},r.createElement("button",{className:"mdc-button mdc-button--raised",onClick:()=>o.instance&&(o.instance.open=!0),disabled:!e.length},r.createElement("span",{className:"mdc-button__ripple"}),r.createElement("span",{className:"mdc-button__label"},a)),r.createElement("div",{id:n,className:"mdc-menu mdc-menu-surface"},r.createElement("ul",{className:"mdc-deprecated-list",role:"menu","aria-hidden":"true","aria-orientation":"vertical",tabIndex:"-1"},d)))};function S({name:e,title:t,checked:a=!1,disabled:c=!1}){return e===k&&r.createElement("li",{key:e,role:"separator",className:"mdc-deprecated-list-divider"})||r.createElement("li",{key:e,id:e,className:["mdc-deprecated-list-item",...c&&["mdc-deprecated-list-item--disabled"]||[]].join(" "),role:"checkbox","aria-checked":a},r.createElement("span",{className:"mdc-deprecated-list-item__ripple"}),r.createElement("span",{className:"mdc-deprecated-list-item__graphic"},r.createElement("div",{className:"mdc-checkbox"},r.createElement("input",{type:"checkbox",name:e,className:"mdc-checkbox__native-control",id:`checkbox-${e}`,defaultChecked:a,disabled:c}),r.createElement("div",{className:"mdc-checkbox__background"},r.createElement("svg",{className:"mdc-checkbox__checkmark",viewBox:"0 0 24 24"},r.createElement("path",{className:"mdc-checkbox__checkmark-path",fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"})),r.createElement("div",{className:"mdc-checkbox__mixedmark"})))),r.createElement("label",{className:"mdc-deprecated-list-item__text",htmlFor:`checkbox-${e}`},t))}let C,I;const T=async()=>C??(async()=>{let e,{email:t,sessionId:a,database:r,server:c}=f()??{};if(!t||!c)try{if(({email:t,password:e,database:r,server:c}=await(I??(I=new Promise(E)))),!(t&&e&&r&&c))throw new Error("Authentication failed")}catch({message:e}){return console.error(e),u.dispatch(p,e)}finally{I=null}if(C)return C;try{return C=new GeotabApi({credentials:{database:r,userName:t,...a&&{sessionId:a}||{password:e}},path:c})}catch({message:e}){console.error(e),u.dispatch(p,e)}})();function D(e,t){return t?async function(e){try{return await((await T())?.multiCall(e))}catch({message:e}){return u.dispatch(p,e),console.error(e),[]}}(e):F("Get",e)}async function L(e){return F("GetAddresses",e)}async function F(e,t){try{return await((await T())?.call(e,t))}catch({message:e}){return u.dispatch(p,e),console.error(e),[]}}const M=({onChange:e})=>{const[t,a]=(0,r.useState)([]),{current:c}=(0,r.useRef)(w),n=(0,r.useContext)(_),s=async()=>{const e=await Promise.all([...c.entries()].map((async([e,{options:t,checked:a,...r}])=>({...r,id:e,options:await Promise.all([...t.values()].map((async e=>{const[{name:t}]=await b.group.get(e);return function({id:e,name:t,checked:a=!1}){return{name:e,title:t,checked:a}}({id:e,name:t,checked:a.has(e)})})))}))));a(e)},i=(0,r.useCallback)((async(t,a)=>{c.get(t).checked=a.includes(N)&&new Set(c.get(t).options)||new Set(a),await async function e({dependentFilter:t,checked:a}){if(!c.has(t))return;const r=await[...a.values()].reduce((async(e,a)=>{const[{children:r=[]}={}]=await(b.group.get(a)??b.group.set(a,D({typeName:"Group",search:{id:a}})).get(a));let c=await(b.group.get(`${a}-children`)??b.group.set(`${a}-children`,D(r.map((({id:e})=>["Get",{typeName:"Group",search:{id:e}}])),!0)).get(`${a}-children`));return c="branches"===t&&c.map((([e])=>{const{id:t}=e;return b.group.set(t,Promise.resolve([e])),t}))||c.reduce(((e,[t])=>{const{id:a,children:{length:r}}=t;return r?(b.group.set(a,Promise.resolve([t])),[...e,a]):e}),[]),new Set([...await e,...c])}),Promise.resolve(new Set));return c.set(t,{...c.get(t),options:r,checked:new Set([...c.get(t).checked.values()].filter((e=>r.has(e))))}),e(c.get(t))}(c.get(t)),s(),e?.([...c.get("branches").checked.values()])}),[]);(0,r.useEffect)((async()=>{const[{children:e={}}={}]=await D({typeName:"Group",search:{id:"b271F"}}),t=(await(b.group.get("b271F-children")??b.group.set("b271F-children",D(e.map((({id:e})=>["Get",{typeName:"Group",search:{id:e}}])),!0)).get("b271F-children"))).reduce(((e,[t])=>{const{id:a,children:{length:r}}=t;return r?(b.group.set(a,Promise.resolve([t])),[...e,a]):e}),[]);c.set("divisions",{...c.get("divisions"),options:new Set(t)}),s()}),[n]);const l=(0,r.useMemo)((()=>t.map((({id:e,options:t,label:a})=>r.createElement("div",{key:e,className:"filter-control"},r.createElement(x,{options:t,name:e,label:a,onChange:i}))))),[t]);return r.createElement("div",{className:"flex flex--spreaded flex--wrap"},l)};var B=a(243),O=a.n(B);const P=(R=new DOMParser,e=>R.parseFromString(e,"text/html").body?.firstElementChild??document.createElement("div"));var R;a(803),a(134);let A,G={};const $={};let q=0;const j=({deviceFilter:e=[],groupFilter:t=[]})=>{const a=(0,r.useContext)(_);return(0,r.useMemo)((()=>{if(q=0,e.length)return new ReadableStream({async pull(t){const a=await async function(e,t,a){return D(e.map((e=>{const r=a[e];return["GetFeed",{typeName:"LogRecord",resultsLimit:1e3,...r&&{fromVersion:r},search:{...!r&&{fromDate:t},deviceSearch:{id:e}}}]})),!0)}(e,function(){const e=new Date;return e.setSeconds(e.getSeconds()-1200),e}().toISOString(),G);G=Object.fromEntries(a.map((({toVersion:t},a)=>[e[a],t]))),a.reduce(((e,{data:t})=>[...e,...t.map(W)]),[]).sort(H).forEach((e=>t.enqueue(e)))}}).getReader()}),[e]),(0,r.useEffect)((async()=>{let[e,t,a,r]=["",[50,30],"",""];try{({accessToken:e,center:t,attribution:a,tileLayerUrl:r}=await(await fetch("./app-config.json")).json())}catch({message:e}){return console.error(e),void u.dispatch(p,e)}A=O().map("leaflet-map").setView(t,11),O().tileLayer(r,{attribution:a,maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:e}).addTo(A)}),[]),(0,r.useEffect)((async()=>{if(clearInterval(void 0),!a||!e.length||!t.length)return V([],$,A);const r=await async function(e){return D({typeName:"DeviceStatusInfo",resultsLimit:1e3,search:{deviceSearch:{groups:e}}})}(t);V(r,$,A);const{latitude:c,longitude:n}=r[r.length-1]??{};c&&n&&A.panTo(O().latLng(c,n),{animate:!0})}),[a,e,t]),r.createElement("div",{id:"leaflet-map",className:"auto-height"})};function U(e){return O().divIcon({iconSize:O().point(24,24),className:"car-icon material-icons"+(e?"":" car-icon--stopped"),html:"directions_car"})}function V(e,t,a){e.forEach((e=>{const{device:{id:r}}=e;if(r in t)return function(e,{latitude:t,longitude:a,speed:r}){return e.setLatLng(O().latLng(t,a)).setIcon(U(r>9))}(t[r],e);t[r]=function({latitude:e,longitude:t,isDriving:a,device:{id:r},...c},n){return O().marker(O().latLng(e,t),{icon:U(a)}).addTo(n).on("mouseover",z,{...c,id:r})}(e,a)}));const r=e.map((({device:{id:e}})=>e));Object.entries(t).forEach((([e,a])=>{r.includes(e)||(a.remove(),delete t[e])}))}async function z(e){var t,a;t=e.target,a=P('<div class="car-tooltip__stub material-icons">access_time</div>'),t.bindTooltip(a).openTooltip();const[{groups:r,driver:{id:c},exceptionEvents:n,isDriving:s,speed:i,latitude:l,longitude:o}]=await D({typeName:"DeviceStatusInfo",resultsLimit:1,search:{deviceSearch:{id:this.id}}}),d=s&&`Driving at ${i} Mph`||"Stopped",[{name:m}]=await(b.device.get(this.id)??b.device.set(this.id,D({typeName:"Device",resultsLimit:1,search:{id:this.id}})).get(this.id)),[{name:u}]=await(b.driver.get(c)??b.driver.set(c,D({typeName:"User",resultsLimit:1,search:{id:c}})).get(c)),p=await Promise.all(n.map((async({rule:{id:e}})=>{const[{name:t}]=await(b.rule.get(e)??b.rule.set(e,D({typeName:"Rule",resultsLimit:1,search:{id:e}})).get(e));return t}))),g=(await Promise.all(r.map((async({id:e})=>{const[{name:t}]=await(b.group.get(e)??b.group.set(e,D({typeName:"Group",resultsLimit:1,search:{id:e}})).get(e));return t})))).join(" "),[{formattedAddress:h}]=await L({coordinates:[{x:o,y:l}],movingAddresses:!0});e.target.setTooltipContent(P((({name:e="",status:t="",groups:a="",driver:r="",driverFICO:c="",location:n="",issues:s=[]})=>`\n        <div class="car-tooltip">\n            <div class="car-tooltip__icon material-icons">directions_car</div>\n            <div class="car-tooltip__name">${e}</div>\n            <div class="car-tooltip__status">${t}</div>\n            <div class="car-tooltip__group">${a}</div>\n            <div class="car-tooltip__driver">${r}</div>\n            <div class="car-tooltip__driver-fico">\n                <span>FICO:</span>\n                <span>${c}</span>\n            </div>\n            <div class="car-tooltip__location">${n}</div>\n            <div class="car-tooltip__issues">${s.reduce(((e,t)=>`${e}<li class="issues__item">${t}</li>`),'<ul class="issues__list">')+"</ul"}</div>\n        </div>`)({name:m,status:d,driver:u,groups:g,issues:p,location:h,driverFICO:"0"})))}function W({dateTime:e,...t}){return{dateTime:Date.parse(e),...t}}function H({dateTime:e},{dateTime:t}){return v(e,t)}var Q=a(828);const J=({head:e,body:t,onClick:a})=>{const[c,n]=(0,r.useState)(null);(0,r.useEffect)((()=>{if(c)return()=>e.destroy();const e=new Q.T(document.getElementById("app-data-table"));return n(e),()=>e.destroy()}),[]),(0,r.useLayoutEffect)((()=>{c?.layout()}),[t]);const s=(0,r.useMemo)((()=>e.map(K)),[e]),i=(0,r.useMemo)((()=>t.reduce(Y,[]).map(Z,[])),[t]);return r.createElement("div",{id:"app-data-table",className:"mdc-data-table auto-width",style:{overflow:"hidden"}},r.createElement("div",{className:"mdc-data-table__table-container"},r.createElement("table",{className:"mdc-data-table__table"},r.createElement("thead",null,r.createElement("tr",{className:"mdc-data-table__header-row"},s)),r.createElement("tbody",{className:"mdc-data-table__content",onClick:a},i))))};function K(e,t){return r.createElement("th",{key:t,className:"mdc-data-table__header-cell",role:"columnheader",scope:"col"},e)}function X(e,t){return r.createElement("td",{key:t,className:"mdc-data-table__cell"},e)}function Y(e,t){return e.find((({id:e})=>e===t.id))?e:[...e,t]}function Z({id:e,columns:t}){return r.createElement("tr",{key:e,className:"mdc-data-table__row"},t.map(X))}let ee,te={},ae=[],re=0;const ce=["Time","Event Name","Vehicle Name","Driver","Location","Branch"],ne=({ruleFilter:e=[],groupFilter:t=[]})=>{const[a,c]=(0,r.useState)([]),n=(0,r.useContext)(_),s=(0,r.useCallback)((()=>{}),[]),i=(0,r.useMemo)((()=>{if(re=0,e.length&&t.length)return new ReadableStream({async pull(a){const r=await ie(e,t,le().toISOString(),te);te=Object.fromEntries(r.map((({toVersion:t},a)=>[e[a],t]))),r.reduce(((e,{data:t})=>[...e,...t.map(oe)]),[]).sort(de).forEach((e=>a.enqueue(e)))}}).getReader()}),[e,t]),l=async()=>{const e=le();await async function t(){if(re>e)return;const a=await i.read(),{value:r}=a,{activeTo:n}=r;return c(ae=[me(await se(r)),...ae]),re=n,t()}()};return(0,r.useEffect)((async()=>{if(clearTimeout(ee),!n||!e.length||!t.length)return ae=[];const a=await ie(e,t,le().toISOString(),{});te=Object.fromEntries(a.map((({toVersion:t},a)=>[e[a],t])));const r=a.reduce(((e,{data:t})=>[...e,...t.map(oe)]),[]).sort(de).slice(-100);c(ae=(await Promise.all(r.map(se))).map(me)),ee=setInterval(l,1e4)}),[n,e,t]),r.createElement(J,{head:ce,body:a,onClick:s})};async function se({id:e,activeFrom:t,activeTo:a,device:{id:r},driver:{id:c},rule:{id:n}}){const{device:s,branch:i}=await(async e=>{const[{name:t="Unknown",groups:[{id:a}]}]=await(b.device.get(e)??b.device.set(e,D({typeName:"Device",resultsLimit:1,search:{id:e}})).get(e)),[{name:r="Unknown"}]=await(b.group.get(a)??b.group.set(a,D({typeName:"Group",resultsLimit:1,search:{id:a}})).get(a));return{device:t,branch:r}})(r),[{name:l="Unknown"}]=await(b.driver.get(c)??b.driver.set(c,D({typeName:"User",resultsLimit:1,search:{id:c}})).get(c)),[{name:o="Unknown"}]=await(b.rule.get(n)??b.rule.set(n,D({typeName:"Rule",resultsLimit:1,search:{id:n}})).get(n)),[{stopPoint:d}={}]=await D({typeName:"Trip",resultsLimit:1,search:{includeOverlappedTrips:!0,fromDate:t,toDate:a,deviceSearch:{id:r}}}),[{formattedAddress:m="Unknown"}]=d&&await L({coordinates:[d]})||{};return{id:e,activeTo:a,rule:o,device:s,driver:l,location:m,branch:i}}async function ie(e,t,a,r){return D(e.map((e=>{const c=r[e];return["GetFeed",{typeName:"ExceptionEvent",resultsLimit:1e3,...c&&{fromVersion:c},search:{...!c&&{fromDate:a},deviceSearch:{groups:t},ruleSearch:{id:e}}}]})),!0)}function le(){const e=new Date;return e.setSeconds(e.getSeconds()-3600),e}function oe({activeTo:e,...t}){return{activeTo:Date.parse(e),...t}}function de({activeTo:e},{activeTo:t}){return v(t,e)}function me({id:e,activeTo:t,rule:a,device:r,driver:c,location:n,branch:s}){return{id:e,columns:[new Date(t).toLocaleTimeString(),a,r,c,n,s]}}const ue={async"user-login"(){try{await T()}catch({message:e}){u.dispatch(p,e)}},"user-logout":function(){C?.forget(),u.dispatch(g,null)}},pe=()=>{const[e,t]=(0,r.useState)(null),a=(0,r.useContext)(_);(0,r.useEffect)((()=>{if(e)return()=>e.destroy();const a=document.getElementById("auth-menu"),r=new s.g(a);return r.setAnchorCorner(i.Ns.BOTTOM_LEFT),r.listen("MDCMenu:selected",(({detail:{item:{id:e}}})=>ue[e]?.())),t(r),()=>r.destroy()}),[]);const c=(0,r.useMemo)((()=>a?.email??"Guest"),[a]),n=(0,r.useMemo)((()=>[r.createElement("li",{key:"user-action",id:a?.email?"user-logout":"user-login",className:"mdc-deprecated-list-item"},r.createElement("span",{className:"mdc-deprecated-list-item__ripple"}),r.createElement("span",{className:"mdc-list-item__text"},a?.email?"Logout":"Login"))]),[a]),l=(0,r.useCallback)((()=>e&&(e.open=!0)),[e]);return r.createElement("div",{className:"mdc-menu-surface--anchor"},r.createElement("button",{className:"mdc-top-app-bar__action-item mdc-button",onClick:l},r.createElement("div",{className:"mdc-button__ripple"}),r.createElement("i",{className:"material-icons mdc-button__icon"},"account_circle"),r.createElement("span",{className:"mdc-button__label mobile-hidden"},c)),r.createElement("div",{id:"auth-menu",className:"mdc-menu mdc-menu-surface"},r.createElement("ul",{className:"mdc-deprecated-list"},n)))},ge=()=>{const[e,t]=(0,r.useState)(f()),[a,c]=(0,r.useState)([]),[s,i]=(0,r.useState)(y),[l,o]=(0,r.useState)(y.map((({name:e})=>e))),[d,m]=(0,r.useState)([]);(0,r.useEffect)((()=>{new n.t(document.getElementById("top-app-bar")),u.subscribe(g,t)}),[]);const p=(0,r.useCallback)((async e=>{if(!e.length)return c([]),m([]);const t=e.sort().join("-"),a=e.map((e=>({id:e}))),r=await(b.device.get(t)??b.device.set(t,D({typeName:"Device",resultsLimit:1e3,search:{groups:a}})).get(t));c(r.map((({id:e})=>e))),m(a)}),[]),h=(0,r.useCallback)(((...[,e])=>{if(e.includes(N))return o(y.map((({name:e})=>e))),i(y);o(e),i(y.map((t=>({...t,checked:e.includes(t.name)}))))}),[]);return r.createElement(_.Provider,{value:e},r.createElement("header",{id:"top-app-bar",className:"mdc-top-app-bar mdc-top-app-bar--fixed"},r.createElement("div",{className:"mdc-top-app-bar__row"},r.createElement("section",{className:"mdc-top-app-bar__section mdc-top-app-bar__section--align-start",style:{flex:"0 1 auto",width:"6em"}},r.createElement("a",{href:"https://www.rollins.com",title:"Rollins Inc."},r.createElement("img",{className:"app-logo",src:"https://www.rollins.com/~/media/Images/R/Rollins-V2/logo/logo.png?h=69&la=en&w=137",alt:"Rollins Inc. - link to home page"}))),r.createElement("section",{className:"mdc-top-app-bar__section"},r.createElement("div",{className:"mdc-typography--headline5 centered",style:{flex:"1 1 auto",fontWeight:"500",lineHeight:"1.2"}},"Real time data")),r.createElement("section",{className:"mdc-top-app-bar__section mdc-top-app-bar__section--align-end",style:{flex:"0 1 auto",width:"6em"}},r.createElement(pe,null)))),r.createElement("main",{id:"root",className:"mdc-top-app-bar--fixed-adjust",style:{maxWidth:"1280px",marginLeft:"auto",marginRight:"auto"}},r.createElement("div",{className:"leaflet-map-container"},r.createElement("div",{className:"leaflet-map-map auto-height"},r.createElement(j,{deviceFilter:a,groupFilter:d}),r.createElement("div",{className:"leaflet-map-overlay"},r.createElement(M,{onChange:p})),r.createElement("div",{className:"leaflet-map-overlay leaflet-map-overlay--right"},r.createElement(x,{options:s,onChange:h,name:"event_configurator",label:"Filter Events"})))),r.createElement("div",{className:"mdc-layout-grid__cell mdc-layout-grid__cell--span-12"},r.createElement(ne,{ruleFilter:l,groupFilter:d}))))};var he=a(825);const ve=()=>{const[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)(0),s=(0,r.useCallback)((()=>n(a+1)),[]),i=(0,r.useCallback)((()=>n(a-1)),[]);return(0,r.useEffect)((()=>{if(e)return()=>e.destroy();const a=new he.z(document.getElementById("app-loader"));return a.determinate=!1,t(a),u.subscribe("pending_request",s),u.subscribe("complete_request",i),()=>a.destroy()}),[]),(0,r.useEffect)((()=>{e&&(a?e.open():e.close())}),[a,e]),(0,c.createPortal)(r.createElement("div",{id:"app-loader",className:"mdc-circular-progress app-loader",role:"progressbar","aria-label":"Example Progress Bar","aria-valuemin":"0","aria-valuemax":"1"},r.createElement("div",{className:"mdc-circular-progress__determinate-container"},r.createElement("svg",{className:"mdc-circular-progress__determinate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},r.createElement("circle",{className:"mdc-circular-progress__determinate-track",cx:"24",cy:"24",r:"18",strokeWidth:"4"}),r.createElement("circle",{className:"mdc-circular-progress__determinate-circle",cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"113.097",strokeWidth:"4"}))),r.createElement("div",{className:"mdc-circular-progress__indeterminate-container"},r.createElement("div",{className:"mdc-circular-progress__spinner-layer"},r.createElement("div",{className:"mdc-circular-progress__circle-clipper mdc-circular-progress__circle-left"},r.createElement("svg",{className:"mdc-circular-progress__indeterminate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},r.createElement("circle",{cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"56.549",strokeWidth:"4"}))),r.createElement("div",{className:"mdc-circular-progress__gap-patch"},r.createElement("svg",{className:"mdc-circular-progress__indeterminate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},r.createElement("circle",{cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"56.549",strokeWidth:"3.2"}))),r.createElement("div",{className:"mdc-circular-progress__circle-clipper mdc-circular-progress__circle-right"},r.createElement("svg",{className:"mdc-circular-progress__indeterminate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},r.createElement("circle",{cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"56.549",strokeWidth:"4"})))))),document.body)};var fe=a(613);const Ee=()=>{const[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)(""),s=(0,r.useCallback)((()=>n("")));return(0,r.useEffect)((()=>{if(e)return()=>e.destroy();const a=new fe.G(document.getElementById("app-snackbar"));return a.labelText="Error",a.closeOnEscape=!0,a.listen("MDCSnackbar:closed",s),t(a),u.subscribe(p,n),()=>a.destroy()}),[]),(0,r.useEffect)((()=>{e&&(a?e.open():e.close())}),[a]),(0,c.createPortal)(r.createElement("aside",{id:"app-snackbar",className:"mdc-snackbar",style:{zIndex:9e3}},r.createElement("div",{className:"mdc-snackbar__surface",role:"status","aria-relevant":"additions"},r.createElement("div",{className:"mdc-snackbar__label","aria-atomic":"false"},a))),document.body)};a(87),c.render(r.createElement(r.Fragment,null,r.createElement(ge,null),r.createElement(Ee,null),r.createElement(ve,null)),document.getElementById("root"))},87:(e,t,a)=>{e.exports=a.p+"app-config.json"}},e=>{e.O(0,[216],(()=>(186,e(e.s=186)))),e.O()}]);