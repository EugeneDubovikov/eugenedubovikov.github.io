"use strict";(self.webpackChunkgeotab=self.webpackChunkgeotab||[]).push([[179],{186:(e,t,a)=>{var n=a(294),c=a(935),s=a(243),r=a.n(s),i=a(974),l=a(252),o=a(479),d=a(403);const m=({title:e,formId:t,submitBtnId:a,children:[c,s],onSubmit:r,onClose:i})=>{const{current:l}=(0,n.useRef)({instance:null});return(0,n.useEffect)((()=>{const e=l.instance=new d.W(document.getElementById("app-dialog"));return e.listen("MDCDialog:closing",i),e.open(),document.getElementById(t)?.addEventListener("submit",r),document.getElementById(t)?.addEventListener("input",(function(e){this.elements[a].disabled=!this.checkValidity()})),()=>l.instance.destroy()}),[]),n.createElement("div",{id:"app-dialog",className:"mdc-dialog"},n.createElement("div",{className:"mdc-dialog__container"},n.createElement("div",{className:"mdc-dialog__surface"},n.createElement("h2",{className:"mdc-dialog__title centered"},e),n.createElement("div",{className:"mdc-dialog__content"},c),n.createElement("div",{className:"mdc-dialog__actions"},n.createElement("button",{type:"button",className:"mdc-button mdc-dialog__button","data-mdc-dialog-action":"close"},n.createElement("div",{className:"mdc-button__ripple"}),n.createElement("span",{className:"mdc-button__label"},"Cancel")),s))),n.createElement("div",{className:"mdc-dialog__scrim"}))};var u=a(113);const p=({type:e="text",name:t,value:a,placeholder:c,autoComplete:s="off",required:r=!1,onChange:i})=>{const[l,o]=(0,n.useState)(null),[d]=(0,n.useState)(f.next().value);return(0,n.useEffect)((()=>{if(l)return()=>l.destroy();const e=new u.K(document.getElementById(d));return o(e),()=>e.destroy()}),[]),(0,n.useEffect)((()=>{l&&(l.value=a)}),[a]),n.createElement("label",{id:d,className:"mdc-text-field mdc-text-field--filled auto-width"},n.createElement("span",{className:"mdc-text-field__ripple"}),n.createElement("span",{className:"mdc-floating-label",id:`${t}Field`},c),n.createElement("input",{type:e,name:t,defaultValue:a,autoComplete:s,className:"mdc-text-field__input",required:r,onChange:i}),n.createElement("span",{className:"mdc-line-ripple"}))},g={_listeners:{},subscribe(e,t,a=null){this._listeners[e]=[...this._listeners[e]??[],[t,a]]},dispatch(e,t){this._listeners[e]?.forEach((([e,a])=>{e.call(a,t)}))},unsubscribe(e,t){const a=this._listeners[e]?.findIndex(t)??-1;a>-1&&this._listeners[e].splice(a,1)},async makeRequest(e){let t;this.dispatch(ACTION.PENDING_REQUEST);try{const a=await fetch(e);try{t=await a.clone().json()}catch(e){t=await a.text()}if(!a.ok)throw new Error(`${t?.error??t}`);return t}catch({message:e}){this.dispatch(ACTION.ERROR_REQUEST,e),console.error(e)}finally{this.dispatch(ACTION.COMPLETE_REQUEST)}}},h="error_request",v="set_user",f=function*(e){for(;;)yield"_react_component_"+e++}(0);function b(e,t){return e>t?1:e<t?-1:0}function _(){try{const{database:e,sessionId:t,userName:a}=JSON.parse(localStorage.getItem("geotabAPI_credentials"));return{email:a,database:e,sessionId:t,server:localStorage.getItem("geotabAPI_server")}}catch(e){}return null}function E(e,t){const a="authorize-form",s="form-submit-btn";c.render(n.createElement(m,{title:"Login to GeoTab",formId:a,submitBtnId:s,onSubmit:t=>{t.preventDefault();const a=new FormData(t?.target),n=a.get("username")?.trim(),s=a.get("password")?.trim(),r=a.get("database")?.trim(),i=a.get("server")?.trim();e({email:n,password:s,database:r,server:i}),g.dispatch(v,{email:n}),c.unmountComponentAtNode(document.getElementById("dialog-pane")),document.body.classList.remove("mdc-dialog-scroll-lock")},onClose:()=>{c.unmountComponentAtNode(document.getElementById("dialog-pane")),document.body.classList.remove("mdc-dialog-scroll-lock"),t(new Error("Authentication failed"))}},[n.createElement("form",{key:"form",id:a,className:"flex flex--column flex--spreaded"},[n.createElement(p,{key:"server-input",name:"server",placeholder:"server",required:!0,value:"my5.geotab.com"}),n.createElement(p,{key:"database-input",name:"database",placeholder:"database",required:!0,value:"rollins"}),n.createElement(p,{key:"email-input",type:"email",name:"username",placeholder:"user name",autoComplete:"email",required:!0}),n.createElement(p,{key:"password-input",type:"password",name:"password",placeholder:"password",autoComplete:"current-password",required:!0})]),n.createElement("button",{key:"submit-button",id:s,type:"submit",form:a,className:"mdc-button mdc-dialog__button data-mdc-dialog-button-default",disabled:!0},[n.createElement("div",{key:"mdc-ripple",className:"mdc-button__ripple"}),n.createElement("span",{key:"submit-button-label",className:"mdc-button__label"},"Login")])]),document.getElementById("dialog-pane"))}const w={driver:new Map,rule:new Map,device:new Map,group:new Map,trip:new Map,exceptionEvent:new Map,common:new Map};function y(e,t){return e?.panTo(L.latLng(...t),{animate:!0})}function k({dateTime:e,...t}){return{dateTime:Date.parse(e),...t}}function N({dateTime:e},{dateTime:t}){return b(e,t)}function x(e){const t=new Date;return t.setSeconds(t.getSeconds()-e),t}const C=n.createContext(null),S="./app-config.json",I=[{name:"ayqvrTR8lIkiMFFZtHz2xdw",title:"Backing Up When Leaving",checked:!0},{name:"aCdkH9ou4QEKRsJmUYQh6CQ",title:"Harsh Acceleration",checked:!0},{name:"auV1Pjb5pTkC5OzkCwOxoJA",title:"Harsh Brake",checked:!0},{name:"a4zk6nwPd-kus-jY3zBPPqw",title:"Harsh Cornering",checked:!0},{name:"RuleAccidentId",title:"Possible Accident",checked:!0},{name:"aX_l5MgXx8UODDE5rq2ovKw",title:"Speeding > 80 MPH",checked:!0}],T=new Map([["divisions",{label:"Division",options:new Set,checked:new Set,dependentFilter:"regions"}],["regions",{label:"Region",options:new Set,checked:new Set,dependentFilter:"branches"}],["branches",{label:"Branch",options:new Set,checked:new Set}]]),D="check_all",M="divider",F=({options:e,name:t,label:a,onChange:c})=>{const[s]=(0,n.useState)(f.next().value),r=(0,n.useCallback)((({detail:{item:e}})=>{let{instance:{list:{listElements:a,selectedIndex:n}}}=i;if(e.id===D){const{checked:n=!1}=e.getElementsByTagName("input").item(0)??{};return c?.(t,n&&a.map((({id:e})=>e))||[])}c?.(t,n.reduce(((e,t)=>[...e,...a[t]?.id!==D&&[a[t]?.id]||[]]),[]))}),[]),{current:i}=(0,n.useRef)({instance:null});(0,n.useEffect)((()=>{i.instance?.unlisten("MDCMenu:selected",r),i.instance?.destroy();const e=document.getElementById(s),t=new l.g(e);t.setAnchorCorner(o.Ns.BOTTOM_LEFT),t.setFixedPosition(!0),t.open=!1,i.instance=t,t.listen("MDCMenu:selected",r)}),[e]);const d=(0,n.useMemo)((()=>[P({name:D,title:"Select all",checked:e.every((({checked:e})=>!!e))}),P({name:M}),...e.map(P)]),[e]);return n.createElement("div",{className:"mdc-menu-surface--anchor"},n.createElement("button",{className:"mdc-button mdc-button--raised",onClick:()=>i.instance&&(i.instance.open=!0),disabled:!e.length},n.createElement("span",{className:"mdc-button__ripple"}),n.createElement("span",{className:"mdc-button__label"},a)),n.createElement("div",{id:s,className:"mdc-menu mdc-menu-surface"},n.createElement("ul",{className:"mdc-deprecated-list",role:"menu","aria-hidden":"true","aria-orientation":"vertical",tabIndex:"-1"},d)))};function P({name:e,title:t,checked:a=!1,disabled:c=!1}){return e===M&&n.createElement("li",{key:e,role:"separator",className:"mdc-deprecated-list-divider"})||n.createElement("li",{key:e,id:e,className:["mdc-deprecated-list-item",...c&&["mdc-deprecated-list-item--disabled"]||[]].join(" "),role:"checkbox","aria-checked":a},n.createElement("span",{className:"mdc-deprecated-list-item__ripple"}),n.createElement("span",{className:"mdc-deprecated-list-item__graphic"},n.createElement("div",{className:"mdc-checkbox"},n.createElement("input",{type:"checkbox",name:e,className:"mdc-checkbox__native-control",id:`checkbox-${e}`,defaultChecked:a,disabled:c}),n.createElement("div",{className:"mdc-checkbox__background"},n.createElement("svg",{className:"mdc-checkbox__checkmark",viewBox:"0 0 24 24"},n.createElement("path",{className:"mdc-checkbox__checkmark-path",fill:"none",d:"M1.73,12.91 8.1,19.28 22.79,4.59"})),n.createElement("div",{className:"mdc-checkbox__mixedmark"})))),n.createElement("label",{className:"mdc-deprecated-list-item__text",htmlFor:`checkbox-${e}`},t))}let R,B;const O=async()=>R??(async()=>{let e,{email:t,sessionId:a,database:n,server:c}=_()??{};if(!t||!c)try{if(({email:t,password:e,database:n,server:c}=await(B??(B=new Promise(E)))),!(t&&e&&n&&c))throw new Error("Authentication failed")}catch({message:e}){return console.error(e),g.dispatch(h,e)}finally{B=null}if(R)return R;try{return R=new GeotabApi({credentials:{database:n,userName:t,...a&&{sessionId:a}||{password:e}},path:c})}catch({message:e}){console.error(e),g.dispatch(h,e)}})();function A(e,t){return t?async function(e){try{return await((await O())?.multiCall(e))}catch({message:e}){return g.dispatch(h,e),console.error(e),[]}}(e):G("Get",e)}async function V(e){return G("GetAddresses",e)}async function G(e,t){try{return await((await O())?.call(e,t))}catch({message:e}){return g.dispatch(h,e),console.error(e),[]}}const $=({onChange:e})=>{const[t,a]=(0,n.useState)([]),{current:c}=(0,n.useRef)(T),s=(0,n.useContext)(C),r=async()=>{const e=await Promise.all([...c.entries()].map((async([e,{options:t,checked:a,...n}])=>({...n,id:e,options:await Promise.all([...t.values()].map((async e=>{const[{name:t}]=await w.group.get(e);return function({id:e,name:t,checked:a=!1}){return{name:e,title:t,checked:a}}({id:e,name:t,checked:a.has(e)})})))}))));a(e)},i=(0,n.useCallback)((async(t,a)=>{c.get(t).checked=a.includes(D)&&new Set(c.get(t).options)||new Set(a),await async function e({dependentFilter:t,checked:a}){if(!c.has(t))return;const n=await[...a.values()].reduce((async(e,a)=>{const[{children:n=[]}={}]=await(w.group.get(a)??w.group.set(a,A({typeName:"Group",search:{id:a}})).get(a));let c=await(w.group.get(`${a}-children`)??w.group.set(`${a}-children`,A(n.map((({id:e})=>["Get",{typeName:"Group",search:{id:e}}])),!0)).get(`${a}-children`));return c="branches"===t&&c.map((([e])=>{const{id:t}=e;return w.group.set(t,Promise.resolve([e])),t}))||c.reduce(((e,[t])=>{const{id:a,children:{length:n}}=t;return n?(w.group.set(a,Promise.resolve([t])),[...e,a]):e}),[]),new Set([...await e,...c].sort())}),Promise.resolve(new Set));return c.set(t,{...c.get(t),options:n,checked:new Set([...c.get(t).checked.values()].filter((e=>n.has(e))))}),e(c.get(t))}(c.get(t)),r(),e?.([...c.get("branches").checked.values()])}),[]);(0,n.useEffect)((async()=>{const[{children:e={}}={}]=await A({typeName:"Group",search:{id:"b271F"}}),t=(await(w.group.get("b271F-children")??w.group.set("b271F-children",A(e.map((({id:e})=>["Get",{typeName:"Group",search:{id:e}}])),!0)).get("b271F-children"))).reduce(((e,[t])=>{const{id:a,children:{length:n}}=t;return n?(w.group.set(a,Promise.resolve([t])),[...e,a]):e}),[]).sort();c.set("divisions",{...c.get("divisions"),options:new Set(t)}),r()}),[s]);const l=(0,n.useMemo)((()=>t.map((({id:e,options:t,label:a})=>n.createElement("div",{key:e,className:"filter-control"},n.createElement(F,{options:t,name:e,label:a,onChange:i}))))),[t]);return n.createElement("div",{className:"flex flex--spreaded flex--wrap"},l)},U=(j=new DOMParser,e=>j.parseFromString(e,"text/html").body?.firstElementChild??document.createElement("div"));var j;a(803),a(134);const q=r().Marker.extend({_setPos(e){this._icon&&(new(r().PosAnimation)).run(this._icon,e,.5,1),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()}});let z,W,H=Promise.resolve(),Q={},J=!1;const K={};let Z;const X=({onReady:e,onClick:t,deviceFilter:a=[],groupFilter:c=[]})=>{const s=(0,n.useContext)(C);Z=t;const i=(0,n.useMemo)((()=>{if(a.length)return new ReadableStream({async pull(e){await H;const t=await async function(e,t,a){return A(e.map((e=>{const n=a[e];return["GetFeed",{typeName:"LogRecord",resultsLimit:1e3,...n&&{fromVersion:n},search:{...!n&&{fromDate:t},deviceSearch:{id:e}}}]})),!0)}(a,x(1200).toISOString(),Q);H=new Promise((e=>setTimeout(e,3e4)));let n=[];({lastVersions:Q,lastData:n}=t.reduce((({lastVersions:e,lastData:t},{data:n,toVersion:c},s)=>{const r=n.map(k).sort(N),i={output:[]};var l;return r.length>1&&r.reduce((l=i,l.output??=[],(e,t)=>{const{longitude:a,latitude:n,dateTime:c}=e,{longitude:s,latitude:r,dateTime:i}=t,o=Math.floor((i-c)/500),d=(s-a)/o,m=(r-n)/o,u=new Array(o).fill(Math.floor((i-c)/o)).map(((t,s)=>({...e,dateTime:+c+t*(s+1),longitude:a+d*(s+1),latitude:n+m*(s+1)})));return l.output=[...l.output,...u],t})),{lastData:[...t,i.output.length&&i.output||n],lastVersions:{...e,[a[s]]:c}}}),{lastVersions:Q,lastData:n}));let[c,s]=[0];do{s=null;const t=n.reduce(((e,t)=>(s??=t[c],t[c]&&[...e,t[c]]||e)),[]);e.enqueue(t),c++}while(s)}},{highWaterMark:20}).getReader()}),[a]),l=async()=>{const{value:e}=await i.read();e.forEach((({device:{id:e}={},...t})=>{e in K&&ae(K[e],t)})),J&&(W=setTimeout(l,500))};return(0,n.useEffect)((async()=>{let[t,a,n,c]=[];try{({accessToken:t,center:a,attribution:n,tileLayerUrl:c}=await(w.common.get("app_config")??w.common.set("app_config",(await fetch(S)).json()).get("app_config")))}catch({message:e}){return console.error(e),void g.dispatch(h,e)}z=r().map("leaflet-map").setView(a,11).on("click",ee),r().tileLayer(c,{attribution:n,maxZoom:18,id:"mapbox/streets-v11",tileSize:512,zoomOffset:-1,accessToken:t}).addTo(z),e?.(z)}),[]),(0,n.useEffect)((async()=>{if(clearTimeout(W),J=!1,!s||!a.length||!c.length)return ne([],K,z);J=!0;const e=await async function(e){return A({typeName:"DeviceStatusInfo",resultsLimit:1e3,search:{deviceSearch:{groups:e}}})}(c);ne(e,K,z);const{latitude:t,longitude:n}=e[e.length-1]??{};t&&n&&(y(z,[t,n]),Q={},W=setTimeout(l,500))}),[s,a,c]),n.createElement("div",{id:"leaflet-map",className:"auto-height"})};function Y(){const e=this.id;Object.entries(K).forEach((([t,a])=>a.setOpacity(t===e?1:.5))),y(z,[this.latitude,this.longitude]),Z?.(e)}function ee(){Object.values(K).forEach((e=>e.setOpacity(1))),Z?.()}function te(e){return r().divIcon({iconSize:r().point(24,24),className:"car-icon material-icons"+(e?"":" car-icon--stopped"),html:"directions_car"})}function ae(e,{latitude:t,longitude:a,speed:n}){return e.setLatLng(r().latLng(t,a)).setIcon(te(!!n))}function ne(e,t,a){e.forEach((e=>{const{device:{id:n}}=e;if(n in t)return ae(t[n],e);t[n]=function({latitude:e,longitude:t,isDriving:a,device:{id:n},...c},s){return new q(r().latLng(e,t),{icon:te(a)}).addTo(s).on("mouseover",ce,{...c,id:n}).on("click",Y,{id:n,latitude:e,longitude:t})}(e,a)}));const n=e.map((({device:{id:e}})=>e));Object.entries(t).forEach((([e,a])=>{n.includes(e)||(a.remove(),delete t[e])}))}async function ce({target:e}){var t,a;t=e,a=U('<div class="car-tooltip__stub material-icons">access_time</div>'),t.bindTooltip(a).openTooltip();const[{groups:n,driver:{id:c},exceptionEvents:s,isDriving:r,speed:i,latitude:l,longitude:o}]=await A({typeName:"DeviceStatusInfo",resultsLimit:1,search:{deviceSearch:{id:this.id}}}),d=r&&`Driving at ${i} Mph`||"Stopped",[{name:m}]=await(w.device.get(this.id)??w.device.set(this.id,A({typeName:"Device",resultsLimit:1,search:{id:this.id}})).get(this.id)),[{name:u}]=await(w.driver.get(c)??w.driver.set(c,A({typeName:"User",resultsLimit:1,search:{id:c}})).get(c)),p=await Promise.all(s.map((async({rule:{id:e}})=>{const[{name:t}]=await(w.rule.get(e)??w.rule.set(e,A({typeName:"Rule",resultsLimit:1,search:{id:e}})).get(e));return t}))),v=(await Promise.all(n.map((async({id:e})=>{const[{name:t}]=await(w.group.get(e)??w.group.set(e,A({typeName:"Group",resultsLimit:1,search:{id:e}})).get(e));return t})))).join(" "),[{formattedAddress:f}]=await V({coordinates:[{x:o,y:l}]}),b=await async function(e){if(!e)return;let t=[];try{const{ficoServiceUrl:e}=await(w.common.get("app_config")??w.common.set("app_config",(await fetch(S)).json()).get("app_config"));if(!e)throw new Error("FICO service URL is not configured");t=await(w.common.get("fico")??w.common.set("fico",(await fetch(e)).json()).get("fico"))}catch({message:e}){return g.dispatch(h,e),void console.error(e)}const{fico:a}=t.find((({device_id:t})=>t===e))??{};return a}(this.id);e.setTooltipContent(U((({name:e="",status:t="",groups:a="",driver:n="",driverFICO:c,location:s="",issues:r=[]})=>`\n        <div class="car-tooltip">\n            <div class="car-tooltip__icon material-icons">directions_car</div>\n            <div class="car-tooltip__name">${e}</div>\n            <div class="car-tooltip__status">${t}</div>\n            <div class="car-tooltip__group">${a}</div>\n            <div class="car-tooltip__driver">${n}</div>\n            <div class="car-tooltip__driver-fico">`+(c&&`\n                    <span>FICO:</span>\n                    <span>${c}</span>`||"")+`\n            </div>\n            <div class="car-tooltip__location">${s}</div>\n            <div class="car-tooltip__issues">${r.reduce(((e,t)=>`${e}<li class="issues__item">${t}</li>`),'<ul class="issues__list">')+"</ul"}</div>\n        </div>`)({name:m,status:d,driver:u,groups:v,issues:p,location:f,driverFICO:b})))}var se=a(828);const re=({head:e,body:t,onClick:a})=>{const{current:c}=(0,n.useRef)({table:null}),s=(0,n.useCallback)((({detail:{rowId:e}})=>a?.(e)),[]);(0,n.useEffect)((()=>{c.table=new se.T(document.getElementById("app-data-table")),c.table.listen("MDCDataTable:rowClick",s)}),[]),(0,n.useLayoutEffect)((()=>{c.table?.layout()}),[t]);const r=(0,n.useMemo)((()=>e.map(ie)),[e]),i=(0,n.useMemo)((()=>t.reduce(oe,[]).map(de,[])),[t]);return n.createElement("div",{id:"app-data-table",className:"mdc-data-table auto-width",style:{overflow:"hidden"}},n.createElement("div",{className:"mdc-data-table__table-container"},n.createElement("table",{className:"mdc-data-table__table"},n.createElement("thead",null,n.createElement("tr",{className:"mdc-data-table__header-row"},r)),n.createElement("tbody",{className:"mdc-data-table__content"},i))))};function ie(e,t){return n.createElement("th",{key:t,className:"mdc-data-table__header-cell",role:"columnheader",scope:"col"},e)}function le(e,t){return n.createElement("td",{key:t,className:"mdc-data-table__cell"},e)}function oe(e,t){return e.find((({id:e})=>e===t.id))?e:[...e,t]}function de({id:e,columns:t}){return n.createElement("tr",{key:e,"data-row-id":e,className:"mdc-data-table__row"},t.map(le))}let me,ue={},pe=[];const ge=["Time","Event","Vehicle","Driver","Location","Branch"],he=({onRowSelect:e,deviceFilter:t,ruleFilter:a=[],groupFilter:c=[]})=>{const[s,r]=(0,n.useState)([]),i=(0,n.useContext)(C),l=(0,n.useCallback)((t=>{e?.(t)}),[e]),o=(0,n.useCallback)((async()=>{const e=await async function(e,t,a,n,c){return A(e.map((e=>{const s=c[e];return["GetFeed",{typeName:"ExceptionEvent",resultsLimit:100,...s&&{fromVersion:s},search:{...!s&&{fromDate:n},deviceSearch:{...a&&{id:a}||{groups:t}},ruleSearch:{id:e}}}]})),!0)}(a,c,t,x(3600).toISOString(),ue);let n;({lastVersions:ue,lastData:n}=await e.reduce((async(e,{data:t,toVersion:n},c)=>{const{lastVersions:s,lastData:r}=await e;return{lastData:[...r,...await Promise.all(t.map((e=>async function({id:e,activeFrom:t,activeTo:a,device:{id:n},driver:{id:c},rule:{id:s}}){const{device:r,branch:i}=await(async e=>{const[{name:t="Unknown",groups:[{id:a}]}]=await(w.device.get(e)??w.device.set(e,A({typeName:"Device",resultsLimit:1,search:{id:e}})).get(e)),[{name:n="Unknown"}]=await(w.group.get(a)??w.group.set(a,A({typeName:"Group",resultsLimit:1,search:{id:a}})).get(a));return{device:t,branch:n}})(n),[{name:l="Unknown"}]=await(w.driver.get(c)??w.driver.set(c,A({typeName:"User",resultsLimit:1,search:{id:c}})).get(c)),[{name:o="Unknown"}]=await(w.rule.get(s)??w.rule.set(s,A({typeName:"Rule",resultsLimit:1,search:{id:s}})).get(s)),d=(await A({typeName:"LogRecord",resultsLimit:100,search:{fromDate:t,toDate:a,deviceSearch:{id:n}}})).map(k).sort(N),[{longitude:m,latitude:u}]=d;w.exceptionEvent.set(e,{tripPoints:d});const[{formattedAddress:p="Unknown"}]=startPoint&&await V({coordinates:[{x:m,y:u}]})||{};return{id:e,activeTo:a,rule:o,device:r,driver:l,location:p,branch:i}}(function({activeTo:e,...t}){return{activeTo:Date.parse(e),...t}}(e)))))],lastVersions:{...s,[a[c]]:n}}}),Promise.resolve({lastVersions:ue,lastData:[]}))),r(pe=[...n.sort(ve).map(fe),...pe].slice(-100))}),[a,c,t]);return(0,n.useEffect)((async()=>{if(clearInterval(me),!i||!(a.length&&c.length||t))return pe=[];ue={},me=setInterval(o,3e4),o()}),[i,a,c,t]),n.createElement(re,{head:ge,body:s,onClick:l})};function ve({activeTo:e},{activeTo:t}){return b(t,e)}function fe({id:e,activeTo:t,rule:a,device:n,driver:c,location:s,branch:r}){return{id:e,columns:[new Date(t).toLocaleTimeString(),a,n,c,s,r]}}const be={async"user-login"(){try{await O()}catch({message:e}){g.dispatch(h,e)}},"user-logout":function(){R?.forget(),g.dispatch(v,null)}},_e=()=>{const[e,t]=(0,n.useState)(null),a=(0,n.useContext)(C);(0,n.useEffect)((()=>{if(e)return()=>e.destroy();const a=document.getElementById("auth-menu"),n=new l.g(a);return n.setAnchorCorner(o.Ns.BOTTOM_LEFT),n.listen("MDCMenu:selected",(({detail:{item:{id:e}}})=>be[e]?.())),t(n),()=>n.destroy()}),[]);const c=(0,n.useMemo)((()=>a?.email??"Guest"),[a]),s=(0,n.useMemo)((()=>[n.createElement("li",{key:"user-action",id:a?.email?"user-logout":"user-login",className:"mdc-deprecated-list-item"},n.createElement("span",{className:"mdc-deprecated-list-item__ripple"}),n.createElement("span",{className:"mdc-list-item__text"},a?.email?"Logout":"Login"))]),[a]),r=(0,n.useCallback)((()=>e&&(e.open=!0)),[e]);return n.createElement("div",{className:"mdc-menu-surface--anchor"},n.createElement("button",{className:"mdc-top-app-bar__action-item mdc-button",onClick:r},n.createElement("div",{className:"mdc-button__ripple"}),n.createElement("i",{className:"material-icons mdc-button__icon"},"account_circle"),n.createElement("span",{className:"mdc-button__label mobile-hidden"},c)),n.createElement("div",{id:"auth-menu",className:"mdc-menu mdc-menu-surface"},n.createElement("ul",{className:"mdc-deprecated-list"},s)))};let Ee;const we={id:null,instance:null},ye=()=>{const[e,t]=(0,n.useState)(_()),[a,c]=(0,n.useState)([]),[s,l]=(0,n.useState)(I),[o,d]=(0,n.useState)(I.map((({name:e})=>e))),[m,u]=(0,n.useState)([]),[p,h]=(0,n.useState)(null);(0,n.useEffect)((()=>{new i.t(document.getElementById("top-app-bar")),g.subscribe(v,t)}),[]);const f=(0,n.useCallback)((e=>Ee=e),[]),b=(0,n.useCallback)((e=>h(e)),[]),E=(0,n.useCallback)((async e=>{if(!e.length)return c([]),u([]);const t=e.sort().join("-"),a=e.map((e=>({id:e}))),n=await(w.device.get(t)??w.device.set(t,A({typeName:"Device",resultsLimit:1e3,search:{groups:a}})).get(t));c(n.map((({id:e})=>e))),u(a)}),[]),k=(0,n.useCallback)(((...[,e])=>{if(e.includes(D))return d(I.map((({name:e})=>e))),l(I);d(e),l(I.map((t=>({...t,checked:e.includes(t.name)}))))}),[]),N=(0,n.useCallback)((e=>{const{tripPoints:t=[[]]}=w.exceptionEvent.get(e)??{},a=t.map((({latitude:e,longitude:t})=>[e,t]));we.instance?.remove(),e!==we.id&&(we.instance=function({points:e,color:t="red"},a){return r().polyline(e,{color:t}).addTo(a)}({points:a},y(Ee,a[0])),we.id=e)}),[]);return n.createElement(C.Provider,{value:e},n.createElement("header",{id:"top-app-bar",className:"mdc-top-app-bar mdc-top-app-bar--fixed"},n.createElement("div",{className:"mdc-top-app-bar__row"},n.createElement("section",{className:"mdc-top-app-bar__section mdc-top-app-bar__section--align-start",style:{flex:"0 1 auto",width:"6em"}},n.createElement("a",{href:"https://www.rollins.com",title:"Rollins Inc."},n.createElement("img",{className:"app-logo",src:"https://www.rollins.com/~/media/Images/R/Rollins-V2/logo/logo.png?h=69&la=en&w=137",alt:"Rollins Inc. - link to home page"}))),n.createElement("section",{className:"mdc-top-app-bar__section"},n.createElement("div",{className:"mdc-typography--headline5 centered",style:{flex:"1 1 auto",fontWeight:"500",lineHeight:"1.2"}},"Real time data")),n.createElement("section",{className:"mdc-top-app-bar__section mdc-top-app-bar__section--align-end",style:{flex:"0 1 auto",width:"6em"}},n.createElement(_e,null)))),n.createElement("main",{id:"root",className:"mdc-top-app-bar--fixed-adjust"},n.createElement("div",{className:"leaflet-map-container"},n.createElement(X,{deviceFilter:a,groupFilter:m,onReady:f,onClick:b}),n.createElement("div",{className:"leaflet-map-overlay leaflet-map-overlay--left"},n.createElement($,{onChange:E})),n.createElement("div",{className:"leaflet-map-overlay leaflet-map-overlay--right"},n.createElement(F,{options:s,onChange:k,name:"event_configurator",label:"Filter Events"}))),n.createElement(he,{ruleFilter:o,deviceFilter:p,groupFilter:m,onRowSelect:N})))};var ke=a(825);const Ne=()=>{const[e,t]=(0,n.useState)(null),[a,s]=(0,n.useState)(0),r=(0,n.useCallback)((()=>s(a+1)),[]),i=(0,n.useCallback)((()=>s(a-1)),[]);return(0,n.useEffect)((()=>{if(e)return()=>e.destroy();const a=new ke.z(document.getElementById("app-loader"));return a.determinate=!1,t(a),g.subscribe("pending_request",r),g.subscribe("complete_request",i),()=>a.destroy()}),[]),(0,n.useEffect)((()=>{e&&(a?e.open():e.close())}),[a,e]),(0,c.createPortal)(n.createElement("div",{id:"app-loader",className:"mdc-circular-progress app-loader",role:"progressbar","aria-label":"Example Progress Bar","aria-valuemin":"0","aria-valuemax":"1"},n.createElement("div",{className:"mdc-circular-progress__determinate-container"},n.createElement("svg",{className:"mdc-circular-progress__determinate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},n.createElement("circle",{className:"mdc-circular-progress__determinate-track",cx:"24",cy:"24",r:"18",strokeWidth:"4"}),n.createElement("circle",{className:"mdc-circular-progress__determinate-circle",cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"113.097",strokeWidth:"4"}))),n.createElement("div",{className:"mdc-circular-progress__indeterminate-container"},n.createElement("div",{className:"mdc-circular-progress__spinner-layer"},n.createElement("div",{className:"mdc-circular-progress__circle-clipper mdc-circular-progress__circle-left"},n.createElement("svg",{className:"mdc-circular-progress__indeterminate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},n.createElement("circle",{cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"56.549",strokeWidth:"4"}))),n.createElement("div",{className:"mdc-circular-progress__gap-patch"},n.createElement("svg",{className:"mdc-circular-progress__indeterminate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},n.createElement("circle",{cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"56.549",strokeWidth:"3.2"}))),n.createElement("div",{className:"mdc-circular-progress__circle-clipper mdc-circular-progress__circle-right"},n.createElement("svg",{className:"mdc-circular-progress__indeterminate-circle-graphic",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg"},n.createElement("circle",{cx:"24",cy:"24",r:"18",strokeDasharray:"113.097",strokeDashoffset:"56.549",strokeWidth:"4"})))))),document.body)};var xe=a(613);const Ce=()=>{const[e,t]=(0,n.useState)(null),[a,s]=(0,n.useState)(""),r=(0,n.useCallback)((()=>s("")));return(0,n.useEffect)((()=>{if(e)return()=>e.destroy();const a=new xe.G(document.getElementById("app-snackbar"));return a.labelText="Error",a.closeOnEscape=!0,a.listen("MDCSnackbar:closed",r),t(a),g.subscribe(h,s),()=>a.destroy()}),[]),(0,n.useEffect)((()=>{e&&(a?e.open():e.close())}),[a]),(0,c.createPortal)(n.createElement("aside",{id:"app-snackbar",className:"mdc-snackbar",style:{zIndex:9e3}},n.createElement("div",{className:"mdc-snackbar__surface",role:"status","aria-relevant":"additions"},n.createElement("div",{className:"mdc-snackbar__label","aria-atomic":"false"},a))),document.body)};a(87),c.render(n.createElement(n.Fragment,null,n.createElement(ye,null),n.createElement(Ce,null),n.createElement(Ne,null)),document.getElementById("root"))},87:(e,t,a)=>{e.exports=a.p+"app-config.json"}},e=>{e.O(0,[216],(()=>(186,e(e.s=186)))),e.O()}]);